<!DOCTYPE html> <html><head>
		<title>SQL Example 1 Row based hierarchy</title>
		<base href="../">
		<meta id="root-path" root-path="../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="MemoryDump - SQL Example 1 Row based hierarchy">
		<meta property="og:title" content="SQL Example 1 Row based hierarchy">
		<meta property="og:description" content="MemoryDump - SQL Example 1 Row based hierarchy">
		<meta property="og:type" content="website">
		<meta property="og:url" content="https://krunalgada.github.io/dist/sql/sql-example-1-row-based-hierarchy.html">
		<meta property="og:image" content="https://krunalgada.github.io/dist/lib/media/whatsapp-image-2024-05-11-at-14.52.19_fe92db07.jpg">
		<meta property="og:site_name" content="MemoryDump">
		<meta name="author" content="Krunal"><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://krunalgada.github.io/dist/lib/rss.xml"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.png"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="preload" href="lib/styles/other-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/other-plugins.css"></noscript><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript></head><body class="publish css-settings-manager theme-light show-inline-title show-ribbon"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="SQL Example 1 Row based hierarchy"><p dir="auto">SQL Example 1 Row based hierarchy</p></h1><div><p dir="auto">Problem was shared in one of WhatsApp group where as part of question only input table and output table was given. with statement that input table has Row wise Hierarchy. </p></div><div><p dir="auto"><span alt="WhatsApp Image 2024-05-11 at 14.52.19_fe92db07.jpg" src="WhatsApp Image 2024-05-11 at 14.52.19_fe92db07.jpg" class="internal-embed media-embed image-embed is-loaded"><img alt="WhatsApp Image 2024-05-11 at 14.52.19_fe92db07.jpg" src="lib/media/whatsapp-image-2024-05-11-at-14.52.19_fe92db07.jpg"></span></p></div><div><p dir="auto">To understand more on the problem statement I modified record set for Input and Output</p></div><div><p dir="auto"><span alt="Pasted image 20240511150910.png" src="Pasted image 20240511150910.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240511150910.png" src="lib/media/pasted-image-20240511150910.png"></span></p></div><div><p dir="auto">First I tried to solve using table given , however I could not identify any solution which could do any kind of manipulation without having index or rank column present in original input table.</p></div><div><p dir="auto">So first assumption I did was to add index column in original input table<br>
<span alt="Pasted image 20240511151124.png" src="Pasted image 20240511151124.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240511151124.png" src="lib/media/pasted-image-20240511151124.png"></span></p></div><div><p dir="auto">Query I used to create table and sample data </p></div><div><pre dir="auto"><code>create table solvehierarchy
(
	rnk int ,
	lvl1 nvarchar(10),
	lvl2 nvarchar(10),
	lvl3 nvarchar(10) ,
	lvl4 nvarchar(10)
)
</code><button class="copy-code-button">Copy</button></pre></div><div><pre dir="auto"><code>insert into solvehierarchy
select 1,'a', null , null , null 
union all
select 2,null, 'b', null, null 
union all
select 3,null, 'c', null, null 
union all
select 4,null, null, 'd', null 
union all
select 5,'e', null, null, null 
union all
select 6,null, 'f', null , null 
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">After analyzing source and target table, My understanding for ask is following </p></div><div><ul dir="auto">
<li data-line="0" dir="auto">Row wise hierarchy data is present in table</li>
<li data-line="1" dir="auto">Representation of data is wherever parent is present then child will start from next row and other values will be null</li>
<li data-line="2" dir="auto">At any given point of time each row will have only 1 not null value </li>
<li data-line="3" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Based on above data, level 1 has 2 child 
<ul dir="auto">
<li data-line="4" dir="auto">so idx 1 has only records in column lvl 1</li>
<li data-line="5" dir="auto">idx 2 and 3 represent child of idx 1 so value is only present in lvl 2 column and NULL in others</li>
</ul>
</li>
<li data-line="6" dir="auto">for idx 2 there is no child</li>
<li data-line="7" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>for idx 3 there is one child 
<ul dir="auto">
<li data-line="8" dir="auto">as any child is represented in new line, idx 4 will have value in lvl 3 and all other values are NULL</li>
</ul>
</li>
<li data-line="9" dir="auto">and pattern repeats with idx value 5 being lvl 1 and idx value 6 is child of idx 5. </li>
<li data-line="10" dir="auto">solution that is needed to show data in roll up form / collapsed form of parent and child in to reduce row number and skewness. </li>
</ul></div><div><p dir="auto">Based on above understanding and different logical breakdown, My solution steps looked like:</p></div><div><p dir="auto"><strong>Step 1 : Fill the null values in each level to get more readable/flat hierarchy.</strong></p></div><div><ul dir="auto">
<li data-line="0" dir="auto">As you can see in below image (Highlighted in Red), for lvl1, <strong>a</strong> is filled in idx value 2,3,4 before we halt as next  lvl1 value is reached.</li>
<li data-line="1" dir="auto"><span alt="Pasted image 20240511154743.png" src="Pasted image 20240511154743.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240511154743.png" src="lib/media/pasted-image-20240511154743.png"></span></li>
<li data-line="2" dir="auto">We repeat the same process for value <strong>e</strong></li>
<li data-line="3" dir="auto">for lvl2 only value <strong>c</strong> has child, so we will fill one cell with that. </li>
<li data-line="4" dir="auto">Other does not have any child so will be skipped. </li>
</ul></div><div><p dir="auto"><strong>Step 2 : for each child if cell above current cell is NULL then fill it with child value.</strong></p></div><div><ul dir="auto">
<li data-line="0" dir="auto">this step is needed to get data in collapsed hierarchy format.</li>
<li data-line="1" dir="auto">I am not sure if there could be any other way we can achieve final output, if anyone can help to avoid this additional step and still get final output that will be great.</li>
<li data-line="2" dir="auto">as you can see in image below, in lvl2, <strong>b</strong> is filled in idx 1 and <strong>f</strong> is filled in idx 2</li>
<li data-line="3" dir="auto">for lvl3 only <strong>d</strong> is filled in idx 3</li>
<li data-line="4" dir="auto"><span alt="Pasted image 20240511155550.png" src="Pasted image 20240511155550.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240511155550.png" src="lib/media/pasted-image-20240511155550.png"></span></li>
</ul></div><div><p dir="auto"><strong>Step 3 : Removing idx field , and then remove duplicate to get required output</strong></p></div><div><ul dir="auto">
<li data-line="0" dir="auto"><span alt="Pasted image 20240511155834.png" src="Pasted image 20240511155834.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240511155834.png" src="lib/media/pasted-image-20240511155834.png"></span></li>
</ul></div><div><p dir="auto">Query to get the solution : </p></div><div><pre dir="auto"><code>select distinct lvl1, lvl2, lvl3, lvl4
from 
(
	select 
		rnk, 
		lvl1, 
		case when lvl2 is null then lead(lvl2) over(order by rnk) else lvl2 end as lvl2,
		case when lvl3 is null then lead(lvl3) over(order by rnk) else lvl3 end as lvl3,
		lvl4
	from 
	(
		select rnk 
			, max(l1rnk) over(order by rnk rows unbounded PRECEDING) as lvl1
			,case when lvl1 is null then max(l2rnk) over(order by rnk rows unbounded PRECEDING) else lvl2 end as lvl2
			, case when lvl1 is null and lvl2 is null then max(l3rnk) over(order by rnk rows unbounded PRECEDING) else lvl3 end as lvl3
			, lvl4
		from solvehierarchy
		cross apply (values (case when lvl1 is not null then lvl1 end)) as a(l1rnk)
		cross apply (values (case when lvl2 is not null then lvl2 end)) as b(l2rnk)
		cross apply (values (case when lvl3 is not null then lvl3 end)) as c(l3rnk)
	) x
)x
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">Actual output :<br>
<span alt="Pasted image 20240511160009.png" src="Pasted image 20240511160009.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240511160009.png" src="lib/media/pasted-image-20240511160009.png"></span></p></div><div><p dir="auto">Special thanks to the articles who helped me in framing the solution :<br>
<a rel="noopener" class="external-link" href="https://www.itprotoday.com/sql-server/last-non-null-puzzle#close-modal" target="_blank">https://www.itprotoday.com/sql-server/last-non-null-puzzle#close-modal</a><br>
<a rel="noopener" class="external-link" href="https://learnsql.com/blog/sql-window-functions-rows-clause/" target="_blank">https://learnsql.com/blog/sql-window-functions-rows-clause/</a></p></div><div class="mod-footer"></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sql\sql-example-1-row-based-hierarchy.html#SQL Example 1 Row based hierarchy"><div class="tree-item-contents heading-link" heading-name="SQL Example 1 Row based hierarchy"><span class="tree-item-title">SQL Example 1 Row based hierarchy</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>